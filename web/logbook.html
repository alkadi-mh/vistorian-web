<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="logbook_s.css">
        <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
        <script type="text/javascript" src="../static/traces/trace.js"></script>
        <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
        <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
        <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.1.1/jspdf.umd.min.js"></script>
        <script src='bookmarkLogConsent.js'></script>
        <script> var exports = {}; </script>
        <script src="../lib/vistorian-vis.js"></script>




        <script type="text/javascript">
            const monthNames = ["January", "February", "March", "April", "May", "June",
                                 "July", "August", "September", "October", "November", "December"];

            var viewType=window.parent.location.pathname;
            if ((viewType.length!=0) && (typeof viewType !== 'undefined')){
                viewType=window.parent.location.pathname.split('/',3)[2].split('.')[0];
            }
            var networkName=window.parent.location.search;
            if(networkName.indexOf('&')>-1){
                networkName=window.parent.location.search.split('&')[1].split('=')[1];
            }   

            class bookmark{
                constructor(id,createdOn,title,viewType,datasetID){
                    this.id=id;
                    this.createdOn=createdOn;
                    this.title=title;
                    this.note="";
                    this.type="";
                    this.analysisOpts=[];
                    this.viewType=viewType;
                    this.networkDataset=datasetID;
                    this.controlsValues=[];
                }
                updateBookmark(title,note,type){
                    this.title=title;
                    this.note=note;
                    this.type=type;
                }
                updateBookmarkTitle(title){
                    this.title=title;
                }
                updateBookmarkNotes(notes){
                    this.note=notes;
                }
                updateBookmarkType(BkType){
                    this.type=BkType;
                }
                updateBookmarkDataset(dataset){
                    this.networkDataset=dataset;
                }
                updateBookmarkAnalysisType(chkbx_AnalysisGroup){
                    this.analysisOpts=[];
                    for (var i=0;i<chkbx_AnalysisGroup.length;i++){
                        if (chkbx_AnalysisGroup[i].checked){
                            this.analysisOpts.push(i);
                        }
                            
                    }
                }
                printBk(){
                    return (this.title + " " + this.notes + " " + this.type + " " +this.viewType + " " +this.viewType + " " + this.analysisOpts.forEach(function(a){ return a;}) + this.controlsValues.toString());
                }
                
            }
            // Holds values of each network's controls
            class networkControls {
                constructor(networkType,startTime,endTime){
                    this.networkType=networkType;
                    this.timeSliderStart=startTime;
                    this.timeSliderEnd=endTime;
                }
            }

            class nodeLinkControls extends networkControls{
                constructor(networkType,startTime,endTime,linkOpacity,nodeOpacity,nodeSize,edgeGap,linkWidth,labellingType){
                    super(networkType,startTime,endTime);
                    this.linkOpacity=linkOpacity;
                    this.nodeOpacity=nodeOpacity;
                    this.nodeSize=nodeSize;
                    this.edgeGap=edgeGap;
                    this.linkWidth=linkWidth;
                    this.labellingType=labellingType;
                }
            }
            class matrixControls extends networkControls{
                constructor(networkType,startTime,endTime,zoom,labellingType){
                    super(networkType,startTime,endTime);
                    this.zoom=zoom;
                    this.labellingType=labellingType;
                }
            }
            class timeArchsControls extends networkControls{
                constructor(networkType,startTime,endTime,labellingType){
                    super(networkType,startTime,endTime);
                    this.labellingType=labellingType;
                }
            }
            class  mapControls extends networkControls{
                constructor(networkType,startTime,endTime,nodeOverlap,linkOpacity,opacityOfPositionlessNodes){
                    super(networkType,startTime,endTime);
                    this.nodeOverlap=nodeOverlap;
                    this.linkOpacity=linkOpacity;
                    this.opacityOfPositionlessNodes=opacityOfPositionlessNodes;
                }
            }
            function checkExistance(no,lstOpts){

                for (var i=0; i<lstOpts.length ; i++)
                    if (parseInt(no)===parseInt(lstOpts[i]))
                        return true;
                return false;
                    
            }
            var counter=0;
            var bookmarksJSONFile=[];
            function locateLogObj(logs,elementId){
                for (var i=0;i<logs.length;i++)
                    if (logs[i].id==elementId)
                        return i;
            }
            function printBookmarks(state){
                var bks=state;
                console.log(bks);
                for (var i=0;i<bookmarksJSONFile.length;i++)
                console.log( bookmarksJSONFile[i].printBk());
                //(bks);
            }
            
            function initializeJSON(){
                visBM = localStorage.getItem("vistorianBookmarks");
                logs = JSON.parse(visBM);
                var i;
                if (typeof logs !== "undefined" && logs!==null){
                    if (logs.length!=0 )
                        for ( i=0;i<logs.length;i++){
                            AddNewLog(logs[i].id,logs[i].createdOn,logs[i].title,logs[i].note,logs[i].type,logs[i].analysisOpts,logs[i].viewType,logs[i].networkDataset);
                    }
                    counter=logs[i-1].id;
                }
            }

            function changeBookmarksView(typeChosen){
                var i;
                var displayVal;
                var bkmElements;
                //Check fo dataview bookmarks 
                bkmElements=document.getElementsByClassName("dataview");      
                if  ((typeChosen=="all") ||(typeChosen=="dataview") )
                    displayVal="block";
                else
                    displayVal="none";
                for (i = 0; i < bkmElements.length; i++) 
                        bkmElements[i].style.display = displayVal;

                 //Check fo nodelink bookmarks                  
                bkmElements=document.getElementsByClassName("nodelink");      
                if  ((typeChosen=="all") ||(typeChosen=="nodelink") )
                    displayVal="block";
                else
                    displayVal="none";
                for (i = 0; i < bkmElements.length; i++) 
                        bkmElements[i].style.display = displayVal;


                //Check fo map bookmarks       
                bkmElements=document.getElementsByClassName("map");      
                if  ((typeChosen=="all") ||(typeChosen=="map") )
                    displayVal="block";
                else
                    displayVal="none";
                for (i = 0; i < bkmElements.length; i++) 
                    bkmElements[i].style.display = displayVal;
                    
                //Check fo matrix bookmarks  
                bkmElements=document.getElementsByClassName("matrix");      
                if  ((typeChosen=="all") ||(typeChosen=="matrix") )
                    displayVal="block";
                else
                    displayVal="none";
                for (i = 0; i < bkmElements.length; i++) 
                    bkmElements[i].style.display = displayVal;
          
                //Check fo dynamicego bookmarks  
                bkmElements=document.getElementsByClassName("dynamicego");      
                if  ((typeChosen=="all") ||(typeChosen=="dynamicego") )
                    displayVal="block";
                else
                    displayVal="none";
                for (i = 0; i < bkmElements.length; i++) 
                        bkmElements[i].style.display = displayVal;

                //Check fo mat-nl bookmarks       
                bkmElements=document.getElementsByClassName("mat-nl");      
                if  ((typeChosen=="all") ||(typeChosen=="mat-nl") )
                    displayVal="block";
                else
                    displayVal="none";
                for (i = 0; i < bkmElements.length; i++) 
                        bkmElements[i].style.display = displayVal;
                    
                //Check fo tileview bookmarks  
                bkmElements=document.getElementsByClassName("tileview");      
                if  ((typeChosen=="all") ||(typeChosen=="tileview") )
                    displayVal="block";
                else
                    displayVal="none";
                for (i = 0; i < bkmElements.length; i++) 
                        bkmElements[i].style.display = displayVal;          
 
            }
            function updateLocalStorage(){
                bookmarksJSON = JSON.stringify(bookmarksJSONFile);
                localStorage.setItem("vistorianBookmarks", bookmarksJSON);
                document.getElementById('lbl_changesState').style.backgroundColor="snow";
                document.getElementById('lbl_changesState').innerText='All changes saved';
            }
            function updatesNotSaved(){
                document.getElementById('lbl_changesState').innerText="Changes have not been saved yet. Click Save button";
                document.getElementById('lbl_changesState').style.backgroundColor="lightyellow";

            }
            function updateHeader(){
                this.parentElement.parentElement.getElementsByClassName("collapsible")[0].innerHTML=this.value;
            }

            function refreshBookmarks(){
               /*  var bksContainer=document.getElementById("logs");
                while (bksContainer.firstChild) {
                    bksContainer.removeChild(bksContainer.firstChild);
                }
                initializeJSON(); */
 //               location.reload();
            }

            function AddNewLog(id,dateCreated,title,note,selectedType,analysisOptions,networkType,networkDataset){
                 var logs=document.getElementById("logs");
                //Create new log div
                var newDiv=document.createElement("div");
                var currentCounterValue;
                //set div ID and network type
                if (id==0){
                    counter++;
                    currentCounterValue=counter;
                    newDiv.className=viewType;
                }
                else{
                    currentCounterValue=id;
                    newDiv.className=networkType
                }
                newDiv.id="div_log_"+currentCounterValue;
                

                 // create inner collapsible div
                 //set bookmark date
                 var newContentDiv=document.createElement("div");
                newContentDiv.id=currentCounterValue;
                newContentDiv.setAttribute("class","content");
                var timeLabelHeader=document.createElement("label");
                timeLabelHeader.innerHTML="Date/Time Created: &nbsp;&nbsp;&nbsp; ";
                timeLabelHeader.style="font-weight: bold;float:left;";
               
                var timeLabel=document.createElement("label");

                var btn_dateTime=document.createElement("span");
                btn_dateTime.id="btn_dateTime"+currentCounterValue;

                if (dateCreated==""){
                    var today = new Date();
                    var date = today.getDate() +'-'+ monthNames[today.getMonth()] +'-'+ today.getFullYear();
                    var time = today.getHours() + ":" + today.getMinutes();// + ":" + today.getSeconds();
                    timeLabel.innerHTML=date+ "  "+time;
                    btn_dateTime.innerHTML=date+ "  "+time;
                }
                else{
                    timeLabel.innerHTML=dateCreated;
                    btn_dateTime.innerHTML=dateCreated;
                }
 
                //create log collapsible title
                var headerButton=document.createElement("button");
                var btn_title=document.createElement("span");
                btn_title.id="btn_title_"+currentCounterValue;

                if (title!="")
                    btn_title.innerHTML=title;
                else
                    btn_title.innerHTML="Bookmark " + currentCounterValue +" : ";;

                headerButton.appendChild(btn_title);
                headerButton.appendChild(document.createElement("br"));
                headerButton.appendChild(btn_dateTime);
            
                headerButton.setAttribute("class","collapsible");
                
                headerButton.addEventListener("click", function() {
                    this.classList.toggle("active");
                    var content = this.nextElementSibling;
                    if (content.style.maxHeight){
                        content.style.maxHeight = null;
                    } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                     } 
                });
 
                newDiv.appendChild(headerButton);

                //set the title update container
                var lbl_title=document.createElement("label");
                lbl_title.innerText="Bookmark Label:"
                lbl_title.style="font-weight: bold;float:left;";

                var newTitle=document.createElement("input");
                newTitle.type="text";
                newTitle.id="txt_title_"+currentCounterValue;
                newTitle.placeholder="Update bookmark label here ..";
                newTitle.addEventListener('keyup', function() {
                    document.getElementById(btn_title.id).innerHTML=this.value;
                    bookmarksJSONFile[locateLogObj(bookmarksJSONFile,this.parentElement.id)].updateBookmarkTitle(this.value);
                    updateLocalStorage();
                });

                lbl_title.htmlFor=newTitle.id;

                newContentDiv.appendChild(lbl_title);
                newContentDiv.appendChild(newTitle);
                newContentDiv.appendChild(document.createElement("br"));

                

                // Add bookmark type (purpose)
                var flagTypes=["Review Data Quality","Test a particular hypothesis","Compare different visualizations","Retrieve specific details","Repeat analysis with new data"];
                var bmTypeLabel=document.createElement("label");
                bmTypeLabel.innerText="Characterize your current activity: ";
                bmTypeLabel.style="font-weight: bold;";
                newContentDiv.appendChild(bmTypeLabel);
                
                var bmType=document.createElement("label");
                bmType.id="lbl_type_"+currentCounterValue;
                bmType.style="font-style: italic; ";
                if (selectedType!="")
                    bmType.innerText=selectedType;
                bmType.style.display="none";
                newContentDiv.appendChild(bmType);
                
                var generalPBtns=["Analyze Data","Learn","Demo to others","Test & Explore Vistorian","Report an Issue"];
                // Add "analyze data" with its sub-types
                var btn= document.createElement("input");
                btn.type="button";
                btn.name="menuButton_"+currentCounterValue;
                btn.classList.add("menuButton"); 
                btn.style=" display: inline-block;";
                btn.value=generalPBtns[0];
                if (selectedType!=""){
                    if (btn.value==selectedType)
                        btn.style.backgroundColor= "#FF7F50"; 
                }
                    
                
                btn.addEventListener('click', function() {
                    document.getElementById(bmType.id).innerText=this.value;
                    frmChk.style.display="block";
                    txt_otherType.style.display="none";
                    document.getElementsByName(this.name).forEach((btn) => {
                            if(btn == this) {
                                btn.style.backgroundColor= "#FF7F50"; 
                                trace.event('bkm_3', ' bookmark type specified', this.value, window.parent.location.pathname);
                            }
                                
                            else 
                                btn.style.backgroundColor= "#bbb"; 
                             });
                    document.getElementById(newContentDiv.id).style.maxHeight=document.getElementById(newContentDiv.id).scrollHeight + "px";
                    bookmarksJSONFile[locateLogObj(bookmarksJSONFile,this.parentElement.id)].updateBookmarkType(document.getElementById(bmType.id).innerText);
                    updatesNotSaved();
                });
                   newContentDiv.appendChild(btn);
                //Add rest of the types except (Other) type
                for (var i=1;i<generalPBtns.length;i++){
                   var btn= document.createElement("input");
                   btn.type="button";
                   btn.classList.add("menuButton"); 
                   btn.style=" display: inline-block;";
                   btn.name="menuButton_"+currentCounterValue;
                   btn.value=generalPBtns[i];
                   if (selectedType!=""){
                    if (btn.value==selectedType)
                        btn.style.backgroundColor= "#FF7F50"; 
                    }
                   btn.addEventListener('click', function() {
                        document.getElementById(bmType.id).innerText=this.value;
                        document.getElementsByName(this.name).forEach((btn) => {
                            if(btn == this) {
                                btn.style.backgroundColor= "#FF7F50"; 
                                trace.event('bkm_3', ' bookmark type specified', this.value, window.parent.location.pathname);
                            }
                            else 
                                btn.style.backgroundColor= "#bbb"; 
                             });
                        txt_otherType.style.display="none";
                        frmChk.style.display="none";
                        bookmarksJSONFile[locateLogObj(bookmarksJSONFile,this.parentElement.id)].updateBookmarkType(document.getElementById(bmType.id).innerText);
                        updatesNotSaved();
                        // updateLocalStorage();
                   });
                   newContentDiv.appendChild(btn);
                }
                btn= document.createElement("input");
                btn.type="button";
                btn.value="Other";
                btn.classList.add("menuButton"); 
                btn.name="menuButton_"+currentCounterValue;
                //create other type textarea
                var txt_otherType=document.createElement("textarea");
                var otherType=true;
                if (selectedType!=""){
                    for (var i=0;i<generalPBtns.length;i++)
                    if (generalPBtns[i]==selectedType){
                        otherType=false;
                        break;
                    }
                }
                else{
                    txt_otherType.placeholder="Explian other type here .. Please don't add personal information";
                    otherType=false;

                }

                if (otherType ){
                    btn.style.backgroundColor= "#FF7F50";
                    txt_otherType.innerText=selectedType;
                }
                btn.addEventListener('click', function() {
                        if (document.getElementById(bmType.id).innerText.length==0)
                            document.getElementById(bmType.id).innerText=this.value;
                        
                        document.getElementsByName(this.name).forEach((btn) => {
                            if(btn == this) {
                                btn.style.backgroundColor= "#FF7F50"; 
                                trace.event('bkm_3', ' bookmark type specified', this.value, window.parent.location.pathname);
                            }
                            else 
                                btn.style.backgroundColor= "#bbb"; 
                             });
                        if (txt_otherType.style.display=="none"){
                            txt_otherType.style.display="inline-block";
                            document.getElementById(newContentDiv.id).style.maxHeight=document.getElementById(newContentDiv.id).scrollHeight + "px";
                        }
                        bookmarksJSONFile[locateLogObj(bookmarksJSONFile,this.parentElement.id)].updateBookmarkType(document.getElementById(bmType.id).innerText);
                        updatesNotSaved();updatesNotSaved()
                        //updateLocalStorage();   
                });
                newContentDiv.appendChild(btn);

                
                if (bmType.innerText==generalPBtns[generalPBtns.length-1])
                    txt_otherType.style.display="block";
                else
                    txt_otherType.style.display="none";

                
                txt_otherType.addEventListener('keyup', function() {
                    document.getElementById(bmType.id).innerText=  this.value;
                    trace.event('bkm_3', ' bookmark type specified', 'Other: ' + this.value, window.parent.location.pathname);
                    if (this.value.length==0)
                        document.getElementById(bmType.id).innerText="Other:"; 
                    bookmarksJSONFile[locateLogObj(bookmarksJSONFile,this.parentElement.id)].updateBookmarkType(document.getElementById(bmType.id).innerText);
                    updatesNotSaved();
                    // updateLocalStorage();
                });
                newContentDiv.appendChild(txt_otherType);
                

                
                var frmChk=document.createElement("form");
                frmChk.action="#";
                if (bmType.innerText==generalPBtns[0]){
                    frmChk.style.display="block";
                }
                else
                    frmChk.style.display="none";
                newContentDiv.appendChild(frmChk);
                var logFlag=document.createElement("fieldset");
                logFlag.name="fs_logType_"+currentCounterValue;
                var selectHeader=document.createElement('legend');
                selectHeader.style="font-weight: bold;";
                selectHeader.innerText="Characterize your analysis: ";
                logFlag.appendChild(selectHeader);
                 for(var i = 0; i < flagTypes.length; i++) {
                    var optChk=document.createElement("input");
                    optChk.type="checkbox";
                    optChk.value=i;
                    optChk.name="chkGroup_"+currentCounterValue;
                    optChk.id="chk_analysis_"+ currentCounterValue+"_"+(i+1);
                    optChk.style="float:left;";
                             
                    optChk.checked=checkExistance(optChk.value,analysisOptions);

                    optChk.addEventListener('click', function() {
                        trace.event('bkm_6', ' bookmark analysis type selected', this.value, window.parent.location.pathname);
                        bookmarksJSONFile[locateLogObj(bookmarksJSONFile,this.name.charAt(this.name.length-1))].updateBookmarkAnalysisType(document.getElementsByName(this.name));
                        updatesNotSaved();
                        //updateLocalStorage();
                    });
                    var opt = document.createElement('label');
                    opt.innerHTML = flagTypes[i];
                    opt.htmlFor = optChk.id;
                    
                    opt.appendChild(optChk);
                    logFlag.appendChild(opt);
                }
                frmChk.appendChild(logFlag);
                newContentDiv.appendChild(frmChk);
                
                var newNote=document.createElement("textarea");
                newNote.id="txt_note_"+currentCounterValue;
                newNote.rows=5;
                if (note!="")
                    newNote.value=note;
                
                newNote.placeholder="Enter your notes here ..";
                newNote.addEventListener('keyup', function() {

                    bookmarksJSONFile[locateLogObj(bookmarksJSONFile,this.parentElement.id)].updateBookmarkNotes(this.value);
                    updatesNotSaved();
                });
                var notesLabel=document.createElement("label");
                notesLabel.innerText="Notes:";
                notesLabel.style="font-weight: bold;";
                notesLabel.htmlFor=newNote.id;
                
                newContentDiv.appendChild(notesLabel);

                newContentDiv.appendChild(newNote);
               
               

                //Add buttons (Restore State|Delete)
                newContentDiv.appendChild(document.createElement("br"));
                newContentDiv.appendChild(document.createElement("br"));
                //Hide restore-state button for non-visualization pages
                if (newDiv.className!= "dataview" ){
                    var restoreButton = document.createElement("input");
                    restoreButton.type = "button";
                    restoreButton.value="Restore Visualization State";
                    restoreButton.addEventListener('click', function() {
                        trace.event('bkm_5', ' bookmark stated', 'restoreted', window.parent.location.pathname);
                       // window.parent.exports.networkcube.vistorian.setState(bookmarksJSONFile[locateLogObj(bookmarksJSONFile,this.parentElement.id)].controlsValues);

                     });
                    newContentDiv.appendChild(restoreButton);
                }

                
                var deleteButton = document.createElement("input");
                deleteButton.type = "button";
                deleteButton.value="Delete Bookmark";
                //deleteButton.style="display:block;";
                
                deleteButton.addEventListener('click', function() {
                    if (confirm('Are you sure you want to Delete?')){
                        this.parentElement.parentElement.remove();
                        bookmarksJSONFile.splice(locateLogObj(bookmarksJSONFile,this.parentElement.id),1);
                        trace.event('bkm_4', ' bookmark ', 'deleted', window.parent.location.pathname);
                        updateLocalStorage();
                    }
                    //logFileJSON.push();

                });
                newContentDiv.appendChild(deleteButton);
                newContentDiv.appendChild(document.createElement("br"));

                /* if (title!="")
                {
                    newContentDiv.style.height=   newContentDiv.scrollHeight +"px";
                } */
                newDiv.appendChild(newContentDiv);
                logs.appendChild(newDiv);

                var newBookmark=new bookmark(currentCounterValue,btn_dateTime.innerHTML,btn_title.innerHTML,newDiv.className,networkName);
                var visIframe=window.parent.document.getElementsByTagName("iframe")[1];
                //window.alert(visIframe[0].src + " ---- " +visIframe[1].src + " ---- " + visIframe[2].src);
                if (title==""){// or if (id==0) as new entry
                    switch (viewType){

                        case "dataview":
                            networkName=window.parent.document.getElementById('networknameInput').value;
                            break;
                        case "nodelink":
                            let startTime=visIframe.contentWindow.document.getElementById("sliderKnobMin").getAttribute('cx');
                            let endTime=visIframe.contentWindow.document.getElementById('sliderKnobMax').getAttribute('cx');
                            let cntrls=visIframe.contentWindow.document.getElementsByTagName('circle');
                            let linkOpacity=cntrls[0].getAttribute('cx');
                            let nodeOpacity=cntrls[1].getAttribute('cx');
                            let nodeSize=cntrls[2].getAttribute('cx');
                            let edgeGap=cntrls[3].getAttribute('cx');
                            let linkWidth=cntrls[4].getAttribute('cx');
                            let labellingType=visIframe.contentWindow.document.getElementById('selection-input_Labeling').value;
                            newBookmark.controlsValues.push(new  nodeLinkControls(viewType,startTime,endTime,linkOpacity,nodeOpacity,nodeSize,edgeGap,linkWidth,labellingType));
                            break;
                            
                        case "matrix":
                            let matrixStartTime=visIframe.contentWindow.document.getElementById("sliderKnobMin").getAttribute('cx');
                            let matrixEndTime=visIframe.contentWindow.document.getElementById('sliderKnobMax').getAttribute('cx');
                            let matrixZoomVal=visIframe.contentWindow.document.getElementById('cellSizeBox').value;
                            let matrixLabellingType=visIframe.contentWindow.document.getElementById('labelOrdering').value;
                            newBookmark.controlsValues.push(new  matrixControls(viewType,matrixStartTime,matrixEndTime,matrixZoomVal,matrixLabellingType));
                            break;
                        case "dynamicego":
                            let dyStartTime=visIframe.contentWindow.document.getElementById("sliderKnobMin").getAttribute('cx');
                            let dyEndTime=visIframe.contentWindow.document.getElementById('sliderKnobMax').getAttribute('cx');
                            let dyLabellingType=visIframe.contentWindow.document.getElementById('labelOrdering').value;
                            newBookmark.controlsValues.push(new  timeArchsControls(viewType,dyStartTime,dyEndTime,dyLabellingType));
                            break;
                        case "map":
                            let mapStartTime=visIframe.contentWindow.document.getElementById("sliderKnobMin").getAttribute('cx');
                            let mapEndTime=visIframe.contentWindow.document.getElementById('sliderKnobMax').getAttribute('cx');
                            let mapCntrls=visIframe.contentWindow.document.getElementsByTagName('circle');
                            let mapNodeOverlap=mapCntrls[0].getAttribute('cx');
                            let mapLinkOpacity=mapCntrls[1].getAttribute('cx');
                            let mapOpacityOfPositionlessNodes=mapCntrls[2].getAttribute('cx');
                            newBookmark.controlsValues.push(new  mapControls(viewType,mapStartTime,mapEndTime,mapNodeOverlap,mapLinkOpacity,mapOpacityOfPositionlessNodes));
                            break;
    /*                    case "mat-nl":
                            let startTime=visIframe.contentWindow.document.getElementById("sliderKnobMin").getAttribute('cx');
                            let endTime=visIframe.contentWindow.document.getElementById('sliderKnobMax').getAttribute('cx');
                            let cntrls=visIframe.contentWindow.document.getElementsByTagName('circle');
                            let linkOpacity=cntrls[0].getAttribute('cx');
                            let nodeOpacity=cntrls[1].getAttribute('cx');
                            let nodeSize=cntrls[2].getAttribute('cx');
                            let edgeGap=cntrls[3].getAttribute('cx');
                            let linkWidth=cntrls[4].getAttribute('cx');
                            let labellingType=visIframe.contentWindow.document.getElementById('selection-input_Labeling').value;
                            newBookmark.controlsValues.push(new  nodeLinkControls(viewType,startTime,endTime,linkOpacity,nodeOpacity,nodeSize,edgeGap,linkWidth,labellingType));

                            var visIframe2_matnl=window.parent.document.getElementsByTagName("iframe")[2];

                            let matrixStartTime=visIframe2_matnl.contentWindow.document.getElementById("sliderKnobMin").getAttribute('cx');
                            let matrixEndTime=visIframe2_matnl.contentWindow.document.getElementById('sliderKnobMax').getAttribute('cx');
                            let matrixZoomVal=visIframe2_matnl.contentWindow.document.getElementById('cellSizeBox').value;
                            let matrixLabellingType=visIframe2_matnl.contentWindow.document.getElementById('labelOrdering').value;
                            newBookmark.controlsValues.push(new  matrixControls(viewType,matrixStartTime,matrixEndTime,matrixZoomVal,matrixLabellingType));

                            break;
                        case "tileview":
                            let startTime=visIframe.contentWindow.document.getElementById("sliderKnobMin").getAttribute('cx');
                            let endTime=visIframe.contentWindow.document.getElementById('sliderKnobMax').getAttribute('cx');
                            let cntrls=visIframe.contentWindow.document.getElementsByTagName('circle');
                            let linkOpacity=cntrls[0].getAttribute('cx');
                            let nodeOpacity=cntrls[1].getAttribute('cx');
                            let nodeSize=cntrls[2].getAttribute('cx');
                            let edgeGap=cntrls[3].getAttribute('cx');
                            let linkWidth=cntrls[4].getAttribute('cx');
                            let labellingType=visIframe.contentWindow.document.getElementById('selection-input_Labeling').value;
                            newBookmark.controlsValues.push(new  nodeLinkControls(viewType,startTime,endTime,linkOpacity,nodeOpacity,nodeSize,edgeGap,linkWidth,labellingType));
                        
                        
                            var visIframe2=window.parent.document.getElementsByTagName("iframe")[2];
                            let matrixStartTime=visIframe2.contentWindow.document.getElementById("sliderKnobMin").getAttribute('cx');
                            let matrixEndTime=visIframe2.contentWindow.document.getElementById('sliderKnobMax').getAttribute('cx');
                            let matrixZoomVal=visIframe2.contentWindow.document.getElementById('cellSizeBox').value;
                            let matrixLabellingType=visIframe2.contentWindow.document.getElementById('labelOrdering').value;
                            newBookmark.controlsValues.push(new  matrixControls(viewType,matrixStartTime,matrixEndTime,matrixZoomVal,matrixLabellingType));

                            var visIframe3=window.parent.document.getElementsByTagName("iframe")[3];
                            let dyStartTime=visIframe3.contentWindow.document.getElementById("sliderKnobMin").getAttribute('cx');
                            let dyEndTime=visIframe3.contentWindow.document.getElementById('sliderKnobMax').getAttribute('cx');
                            let dyLabellingType=visIframe3.contentWindow.document.getElementById('labelOrdering').value;
                            newBookmark.controlsValues.push(new  timeArchsControls(viewType,dyStartTime,dyEndTime,dyLabellingType));


                            var visIframe4=window.parent.document.getElementsByTagName("iframe")[4];
                            let mapStartTime=visIframe4.contentWindow.document.getElementById("sliderKnobMin").getAttribute('cx');
                            let mapEndTime=visIframe4.contentWindow.document.getElementById('sliderKnobMax').getAttribute('cx');
                            let mapCntrls=visIframe4.contentWindow.document.getElementsByTagName('circle');
                            let mapNodeOverlap=mapCntrls[0].getAttribute('cx');
                            let mapLinkOpacity=mapCntrls[1].getAttribute('cx');
                            let mapOpacityOfPositionlessNodes=mapCntrls[2].getAttribute('cx');
                            newBookmark.controlsValues.push(new  mapControls(viewType,mapStartTime,mapEndTime,mapNodeOverlap,mapLinkOpacity,mapOpacityOfPositionlessNodes));


                            break;
    */
                        default:
                            //alert to be deleted - just for testing purposes
                            console.log("Unable to classify bookmark type"); 
                    }
                }
                else

                newBookmark.updateBookmarkDataset(networkName);
                bookmarksJSONFile.push(newBookmark);

            }
            function generatePDF(){
                var pdfMake = require('pdfmake/build/pdfmake.js');
                var pdfFonts = require('pdfmake/build/vfs_fonts.js');
                pdfMake.vfs = pdfFonts.pdfMake.vfs; 
                var doc = new jsPDF();
                bookmarksJSONFile.forEach(function(bookmark, i){
                    doc.text(20, 10 + (i * 10), 
                        "Title: " + bookmark.title + 
                        "Date/Time Created: " + bookmark.dateCreated +
                        "Note: " + bookmark.note + 
                        "Type: " + bookmark.type );
                    });
                    doc.save('vistorian_bookmarks.pdf');
            }
            function takeScreenShot() {
                
            }
            
            
        </script>
    </head>
    <body id="capture" onload="initializeJSON();" onerror="trace.event('err', event + ' ' + source + lineno, error, document.location.pathname);" onfocus="refreshBookmarks();">
       
        <div id="logbook_container" data-role="page">
            <div>
                <form action="#">
                    <input type="radio" id="allBM" name="bmTypeSelection" value="all" onchange="changeBookmarksView('all');trace.event('bkm_7', ' show all bookmarks (view)', 'selected', window.parent.location.pathname);" checked >
                    <label for="allBM">Show all bookmarks</label>
                    <input type="radio" id="specificBM" name="bmTypeSelection" value="specific" onchange="changeBookmarksView(viewType);trace.event('bkm_7', ' show current view bookmarks', 'selected', window.parent.location.pathname);">
                    <label for="specificBM">Show bookmarks only of current visualization </label><br>
                </form>
            </div>
            <div>
                <label id="lbl_changesState" style="background-color:snow;align-items: center;text-align: center;font-weight: bold;"></label>
                <br>
            </div>
            <div id="logbook_header"  class="hd_div" >  
                
                <button  id="addNewBookmark" value="Add New" class="hd_btn"  onclick="AddNewLog(0,'','','','',[],viewType,networkName);trace.event('bkm_1', ' new bookmark', 'created', window.parent.location.pathname);updatesNotSaved();">Add New</button>
                <button  id="btn_save" value="Save" class="hd_btn"  onclick="updateLocalStorage();trace.event('bkm_2', ' updates/changes', 'saved by user', window.parent.location.pathname);">Save Bookmarks</button>

          
            </div>
            <div id="logs" data-role="main" class="ui-content">

            </div>
            <div>
               <!-- <button onclick="generatePDF()">Export as a PDF</button>
                <button onclick="takeScreenShot()">Take Screenshot</button> -->
                <button onclick="location.href='mailto:vistorian@inria.fr?subject=(Vistorian)Consultation Request&body=Hi, kindly I would like to arrange a 10-minutes meeting to consult about my data\'s visualization. Thank you.';trace.event('com_3', window.parent.location.pathname, 'bookmark_tool', 'consult_team');">Email Us & Consult an Expert</button>
                <button onclick="location.href='mailto:vistorian@inria.fr?subject=(Vistorian)Report Technical Bug&body=Please help me in the following technical problem:\n';trace.event('com_4', window.parent.location.pathname, 'bookmark_tool', 'ReportTechBug');">Report a Technical Bug</button>
            </div>


        </div>


    </body>

</html>